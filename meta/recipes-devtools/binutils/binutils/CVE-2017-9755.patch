From 0d96e4df4812c3bad77c229dfef47a9bc115ac12 Mon Sep 17 00:00:00 2001
From: "H.J. Lu" <hjl.tools@gmail.com>
Date: Thu, 15 Jun 2017 06:40:17 -0700
Subject: [PATCH] i386-dis: Check valid bnd register

Since there are only 4 bnd registers, return "(bad)" for register
number > 3.

	PR binutils/21594
	* i386-dis.c (OP_E_register): Check valid bnd register.
	(OP_G): Likewise.
---
 opcodes/ChangeLog  |    6 ++++++
 opcodes/i386-dis.c |   10 ++++++++++
 2 files changed, 16 insertions(+)

diff --git a/opcodes/ChangeLog b/opcodes/ChangeLog
index e489d43..008956a 100644
--- a/opcodes/ChangeLog
+++ b/opcodes/ChangeLog
@@ -7,6 +7,12 @@
 	(DIs, SIs, S2Is, rx_disp): Use new macros.
 	* rx-decode.c: Regenerate.
 
+2017-06-15  H.J. Lu  <hongjiu.lu@intel.com>
+
+	PR binutils/21594
+	* i386-dis.c (OP_E_register): Check valid bnd register.
+	(OP_G): Likewise.
+
 2017-06-15  Nick Clifton  <nickc@redhat.com>
 
 	PR binutils/21595
diff --git a/opcodes/i386-dis.c b/opcodes/i386-dis.c
index b35dbc0..d461d08 100644
--- a/opcodes/i386-dis.c
+++ b/opcodes/i386-dis.c
@@ -15025,6 +15025,11 @@ OP_E_register (int bytemode, int sizeflag)
       names = address_mode == mode_64bit ? names64 : names32;
       break;
     case bnd_mode:
+      if (reg > 0x3)
+	{
+	  oappend ("(bad)");
+	  return;
+	}
       names = names_bnd;
       break;
     case indir_v_mode:
@@ -15569,6 +15574,11 @@ OP_G (int bytemode, int sizeflag)
       oappend (names64[modrm.reg + add]);
       break;
     case bnd_mode:
+      if (modrm.reg > 0x3)
+	{
+	  oappend ("(bad)");
+	  return;
+	}
       oappend (names_bnd[modrm.reg]);
       break;
     case v_mode:
-- 
1.7.9.5

