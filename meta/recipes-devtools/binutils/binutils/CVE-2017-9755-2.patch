From 8cac017d35ef374e65acc98818a17cf8a652cbd0 Mon Sep 17 00:00:00 2001
From: "H.J. Lu" <hjl.tools@gmail.com>
Date: Thu, 15 Jun 2017 08:21:48 -0700
Subject: [PATCH] i386-dis: Add 2 tests with invalid bnd register

	PR binutils/21594
	* testsuite/gas/i386/mpx.s: Add 2 tests with invalid bnd
	register.
	* testsuite/gas/i386/x86-64-mpx.s: Likewise.
	* testsuite/gas/i386/mpx.d: Updated.
	* testsuite/gas/i386/x86-64-mpx.d: Likewise.
---
 gas/ChangeLog                       |    9 +++++++++
 gas/testsuite/gas/i386/mpx.d        |    4 ++++
 gas/testsuite/gas/i386/mpx.s        |   12 ++++++++++++
 gas/testsuite/gas/i386/x86-64-mpx.d |    4 ++++
 gas/testsuite/gas/i386/x86-64-mpx.s |   12 ++++++++++++
 5 files changed, 41 insertions(+)

diff --git a/gas/ChangeLog b/gas/ChangeLog
index f4506ce..38ffc66 100644
--- a/gas/ChangeLog
+++ b/gas/ChangeLog
@@ -1,3 +1,12 @@
+2017-06-15  H.J. Lu  <hongjiu.lu@intel.com>
+
+	PR binutils/21594
+	* testsuite/gas/i386/mpx.s: Add 2 tests with invalid bnd
+	register.
+	* testsuite/gas/i386/x86-64-mpx.s: Likewise.
+	* testsuite/gas/i386/mpx.d: Updated.
+	* testsuite/gas/i386/x86-64-mpx.d: Likewise.
+
 2016-12-01  Nick Clifton  <nickc@redhat.com>
 
 	PR gas/20898
diff --git a/gas/testsuite/gas/i386/mpx.d b/gas/testsuite/gas/i386/mpx.d
index 0e84b9b..c7c08ad 100644
--- a/gas/testsuite/gas/i386/mpx.d
+++ b/gas/testsuite/gas/i386/mpx.d
@@ -130,4 +130,8 @@ Disassembly of section .text:
 
 [a-f0-9]+ <foo>:
 [ 	]*[a-f0-9]+:	f2 c3                	bnd ret 
+
+[a-f0-9]+ <bad>:
+[ 	]*[a-f0-9]+:	0f 1a 30             	bndldx \(%eax\),\(bad\)
+[ 	]*[a-f0-9]+:	66 0f 1a c4          	bndmov \(bad\),%bnd0
 #pass
diff --git a/gas/testsuite/gas/i386/mpx.s b/gas/testsuite/gas/i386/mpx.s
index 3d1b5d0..1ae51fc 100644
--- a/gas/testsuite/gas/i386/mpx.s
+++ b/gas/testsuite/gas/i386/mpx.s
@@ -157,3 +157,15 @@ start:
 	bnd ret
 
 foo:	bnd ret
+
+bad:
+	# bndldx (%eax),(bad)
+	.byte 0x0f
+	.byte 0x1a
+	.byte 0x30
+
+	# bndmov (bad),%bnd0
+	.byte 0x66
+	.byte 0x0f
+	.byte 0x1a
+	.byte 0xc4
diff --git a/gas/testsuite/gas/i386/x86-64-mpx.d b/gas/testsuite/gas/i386/x86-64-mpx.d
index b798649..e2a7828 100644
--- a/gas/testsuite/gas/i386/x86-64-mpx.d
+++ b/gas/testsuite/gas/i386/x86-64-mpx.d
@@ -182,4 +182,8 @@ Disassembly of section .text:
 
 [a-f0-9]+ <foo>:
 [ 	]*[a-f0-9]+:	f2 c3                	bnd retq 
+
+[a-f0-9]+ <bad>:
+[ 	]*[a-f0-9]+:	0f 1a 30             	bndldx \(%rax\),\(bad\)
+[ 	]*[a-f0-9]+:	66 0f 1a c4          	bndmov \(bad\),%bnd0
 #pass
diff --git a/gas/testsuite/gas/i386/x86-64-mpx.s b/gas/testsuite/gas/i386/x86-64-mpx.s
index 0db4bdc..1263408 100644
--- a/gas/testsuite/gas/i386/x86-64-mpx.s
+++ b/gas/testsuite/gas/i386/x86-64-mpx.s
@@ -209,3 +209,15 @@ start:
 	bnd ret
 
 foo:	bnd ret
+
+bad:
+	# bndldx (%eax),(bad)
+	.byte 0x0f
+	.byte 0x1a
+	.byte 0x30
+
+	# bndmov (bad),%bnd0
+	.byte 0x66
+	.byte 0x0f
+	.byte 0x1a
+	.byte 0xc4
-- 
1.7.9.5

