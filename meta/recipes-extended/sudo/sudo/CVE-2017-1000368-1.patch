# HG changeset patch
# User Todd C. Miller <Todd.Miller@courtesan.com>
# Date 1496162651 21600
# Node ID ef737b5d4ed831178f6049e50ef085d79438d92a
# Parent  7ab1be502dc3ad227c6f6c687b004cea3b94bd66
Use /proc/self consistently on Linux.  As far as I know, only AIX
doesn't support /proc/self.

diff -r 7ab1be502dc3 -r ef737b5d4ed8 src/ttyname.c
--- a/src/ttyname.c	Tue May 30 10:44:11 2017 -0600
+++ b/src/ttyname.c	Tue May 30 10:44:11 2017 -0600
@@ -455,7 +455,8 @@
 char *
 get_process_ttyname(char *name, size_t namelen)
 {
-    char path[PATH_MAX], *line = NULL;
+    const char path[] = "/proc/self/stat";
+    char *line = NULL;
     char *rval = NULL;
     size_t linesize = 0;
     int serrno = errno;
@@ -463,8 +464,7 @@
     FILE *fp;
     debug_decl(get_process_ttyname, SUDO_DEBUG_UTIL)
 
-    /* Try to determine the tty from tty_nr in /proc/pid/stat. */
-    snprintf(path, sizeof(path), "/proc/%u/stat", (unsigned int)getpid());
+    /* Try to determine the tty from tty_nr in /proc/self/stat. */
     if ((fp = fopen(path, "r")) != NULL) {
 	len = getline(&line, &linesize, fp);
 	fclose(fp);
